(()=>{var j=(o=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(o,{get:(s,l)=>(typeof require<"u"?require:s)[l]}):o)(function(o){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+o+'" is not supported')});function v(o=f=>f,{imports:s,message:l,transfer:e,port:t,blocking:d,pool:R,loop:p,animate:u,callback:S}={}){return new Promise((f,W)=>{let T;if(typeof o!="function"){if(typeof o=="string"&&o.startsWith("./")){let m=location.origin,i=location.pathname.split("/");i.pop();let c=i.join("/");c.startsWith("http")?m+="/":m+=c+"/",o=m+o}T=o}else T=V(o,s);let M=m=>{let i={},c=!1;m.onmessage=n=>{for(let a in i)i[a](n.data.message,n.data.cb)},m.onerror=n=>{console.error(new Error("Worker encountered an error: "+n.message))};let h=(n,a,r)=>new Promise((g,O)=>{if(!r&&m.PORTS)m.postMessage({message:n,overridePort:r},a),g(!0);else{if(d){if(c)return new Promise((P,K)=>{K("Thread Blocked")});c=!0}let b=Math.random();i[b]=(P,K)=>{b===K&&(delete i[b],d&&(c=!1),g(P))},m.postMessage({message:n,cb:b,overridePort:r},a)}}),E={run:(n,a,r)=>h(n,a,r),terminate:()=>{if(URL.revokeObjectURL(T),m.terminate(),m.PORTS){let n=(a,r)=>{a.postMessage({COMMAND:{DELETED:m.id}})};m.PORTS.forEach(n)}},addPort:n=>C(m,n,d),addCallback:(n=r=>{},a)=>{let r=Math.random();return i[r]=a?g=>{n(g),delete i[r]}:n,r},removeCallback:n=>{delete E.callbacks[n]},setLoop:(n,a,r)=>{m.postMessage({message:a,COMMAND:{SETLOOP:n}},r)},setAnimation:(n,a)=>{m.postMessage({message:n,COMMAND:{SETANIM:!0}},a)},stop:()=>{m.postMessage({COMMAND:{STOP:!0}})},worker:m,callbacks:i,id:m.id};return S&&E.addCallback(S),p?E.setLoop(p,l,e):u&&E.setAnimation(l,e),E};if(R){let m=function(){let E=new Worker(T,s||typeof o!="function"?{type:"module"}:void 0),n=Math.random();return E.id=n,i[n]=E,n},i={},c={};for(let E=0;E<R;E++)m();let h=Object.keys(i);if(t&&h.forEach((E,n)=>{let a=i[E];Array.isArray(t)?t.length===h.length?C(a,t[n],d):t.forEach(r=>{C(a,r,d)}):C(a,t,d)}),l&&!p&&!u)Promise.all(h.map((E,n)=>{let a=i[E],r=Array.isArray(l)?l[n]:l;return new Promise((g,O)=>{a.onmessage=P=>{Promise.resolve().then(()=>{a.terminate(),delete i[a.id]}),g(P.data.message)},a.onerror=P=>{Promise.resolve().then(()=>{a.terminate(),delete i[a.id]}),O(new Error("Worker encountered an error: "+P.message))};let b={message:r,oneOff:!0};a.postMessage(b,e)})})).then(E=>{URL.revokeObjectURL(T),f(E)}).catch(E=>{URL.revokeObjectURL(T),Object.keys(i).map((n,a)=>{let r=i[n];r&&r.terminate(),delete i[n],delete c.helpers?.[n]}),W(E)});else{let E=0;Object.assign(c,{workers:i,helpers:{},keys:h,run:(a,r,g,O)=>{if(O)return c.helpers[O]?.run(a,r);if(Array.isArray(a)){let b=a.length,P=[];for(let K=0;K<b;K++){let x=c.helpers[h[E]].run(a[K],r[K],g);E++,E>=h.length&&(E=0),P.push(x)}return P}else{let b=c.helpers[h[E]].run(a,r,g);return E++,E>=h.length&&(E=0),b}},terminate:a=>{function r(g){c.helpers[g]?.terminate(),delete c.helpers[g],delete c.workers[g]}a?r(a):h.forEach(r)},addWorker:()=>{let a=m(),r=i[a];return n(r),h.length=0,h.push(...h),a},addPort:(a,r)=>{function g(O){return c.helpers[O]?.addPort(a),!0}return r?g(r):h.map(g)},addCallback:(a,r,g)=>{function O(b){return c.helpers[b]?.addCallback(a,r)}return g?O(g):h.map(O)},removeCallback:(a,r)=>{function g(O){return c.helpers[O]?.removeCallback(a),!0}return r?g(r):h.map(g)},setLoop:(a,r,g,O)=>{function b(P){c.helpers[P]?.setLoop(a,r,g)}return O?b(O):h.map(b)},setAnimation:(a,r,g)=>{function O(b){c.helpers[b]?.setAnimation(a,r)}return g?O(g):h.map(O)},stop:a=>{function r(g){c.helpers[g]?.stop()}return a?r(a):h.map(r)}});let n=a=>{c.helpers[a.id]=M(a)};Object.keys(i).forEach((a,r)=>{n(i[a])}),f(c)}}else{let m=Math.random(),i=new Worker(T,s||typeof o!="function"?{type:"module"}:void 0);if(i.id=m,t&&(t.id||(t.id=Math.random()),Array.isArray(t)?t.map(c=>{C(i,c,d)}):C(i,t,d)),l&&!p&&!u)i.onmessage=c=>{Promise.resolve().then(()=>{i.terminate(),URL.revokeObjectURL(T)}),f(c.data.message)},i.onerror=c=>{Promise.resolve().then(()=>{i.terminate(),URL.revokeObjectURL(T)}),W(new Error("Worker encountered an error: "+c.message))},i.postMessage({message:l,oneOff:!0},e);else{let c=M(i);f(c)}}})}function U(o){let s=location.pathname.split("/");s.pop();let l=location.origin+s.join("/")+"/";return typeof o=="string"?(o.startsWith("./")&&(o=l+o),o.includes("import")?`${o}`:`import '${o}';`):Array.isArray(o)?o.map(e=>(e.startsWith("./")&&(e=l+e),e.includes("import")?e:`import '${e}';`)).join(`
`):typeof o=="object"?Object.entries(o).map(([e,t])=>(e.startsWith("./")&&(e=l+e),typeof t=="string"?`import ${t} from '${e}';`:typeof t=="boolean"&&t?`import '${e}'`:`import { ${Object.entries(t).map(([d,R])=>typeof R=="string"?`${d} as ${R}`:d).join(", ")} } from '${e}';`)).join(`
`)+"":""}function C(o,s,l){let e=new MessageChannel;o.id||(o.id=Math.random()),s.id||(s.id=Math.random()),o.postMessage({COMMAND:{SENDER:e.port1,id:s.id,blocking:l}},[e.port1]),s.postMessage({COMMAND:{RECEIVER:e.port2,id:o.id,blocking:l}},[e.port2]),o.PORTS||(o.PORTS=[]),o.PORTS.push(s),s.PORTS||(s.PORTS=[]),s.PORTS.push(o)}var F=(o=()=>{})=>{globalThis.WORKER={},o=o.bind(globalThis.WORKER);let s=(e,t,d,R)=>{if(globalThis.WORKER.SENDERS&&R!==!0)if(R!==void 0&&R!=="both")globalThis.WORKER.SENDERS[R]&&(e?.message?globalThis.WORKER.SENDERS[R].postMessage({message:e.message,overridePort:e?.overridePort},e.transfer):globalThis.WORKER.SENDERS[R].postMessage({message:e,overridePort:e?.overridePort}));else{for(let p in globalThis.WORKER.SENDERS){if(globalThis.WORKER.BLOCKING[p]){if(globalThis.WORKER.BLOCKED[p]){console.error("Thread Blocked: "+p);continue}globalThis.WORKER.BLOCKED[p]=!0}e?.message?globalThis.WORKER.SENDERS[p].postMessage({message:e.message,overridePort:e?.overridePort},e.transfer):globalThis.WORKER.SENDERS[p].postMessage({message:e,overridePort:e?.overridePort})}d&&postMessage(!0)}(!globalThis.WORKER.SENDERS||R===!0||R==="both")&&(e?.message?postMessage({message:e.message,cb:t,overridePort:e?.overridePort},e.transfer):postMessage({message:e,cb:t,overridePort:e?.overridePort}))},l=(e,t)=>{let d=o(e.data?.message);d?.then?d.then(R=>{t&&t.postMessage(!0),s(R,e.data.cb,e.data.oneOff,e.data.overridePort)}):(t&&t.postMessage(!0),s(d,e.data.cb,e.data.oneOff,e.data.overridePort))};globalThis.onmessage=e=>{if(e.data?.COMMAND){let t=e.data.COMMAND;if(typeof t.SETLOOP=="number"){globalThis.WORKER.LOOP&&clearTimeout(globalThis.WORKER.LOOP);let d=()=>{l(e),globalThis.WORKER.LOOP=setTimeout(()=>{d()},t.SETLOOP)};d()}if(t.SETANIM){globalThis.WORKER.ANIM&&cancelAnimationFrame(globalThis.WORKER.ANIM);let d=()=>{l(e),globalThis.WORKER.ANIM=requestAnimationFrame(()=>{d()})};d()}if(t.STOP&&(globalThis.WORKER.LOOP&&clearTimeout(globalThis.WORKER.LOOP),globalThis.WORKER.ANIM&&cancelAnimationFrame(globalThis.WORKER.ANIM)),t.RECEIVER){let d=t.blocking;globalThis.WORKER.RECEIVERS||(globalThis.WORKER.RTCR=0,globalThis.WORKER.RECEIVERS={});let R=t.id;globalThis.WORKER.RECEIVERS[R]=t.RECEIVER,globalThis.WORKER.RTCR++,t.RECEIVER.onmessage=p=>{l(p,d?t.RECEIVER:void 0)},t.RECEIVER.onerror=p=>{delete globalThis.WORKER.RECEIVERS[R]}}if(t.SENDER){globalThis.WORKER.SENDERS||(globalThis.WORKER.PCTR=0,globalThis.WORKER.SENDERS={},globalThis.WORKER.BLOCKING={},globalThis.WORKER.BLOCKED={});let d=t.blocking,R=t.id?t.id:globalThis.WORKER.PCTR;globalThis.WORKER.SENDERS[R]=t.SENDER,globalThis.WORKER.PCTR++,d&&(globalThis.WORKER.BLOCKING[R]=!0),t.SENDER.onmessage=p=>{globalThis.WORKER.BLOCKING[R]&&(globalThis.WORKER.BLOCKED[R]=!1)},t.SENDER.onerror=p=>{delete globalThis.WORKER.SENDERS[R]}}t.DELETED&&(delete globalThis.WORKER.RECEIVERS?.[t.DELETED],delete globalThis.WORKER.SENDERS?.[t.DELETED])}else l(e)},globalThis.onerror=e=>{console.error(e)}},B=F.toString(),V=(o,s)=>{let l=B.replace("()=>{}",o.toString()),e=`${U(s)}

(${l})()`,t=new Blob([e],{type:"application/javascript"});return URL.createObjectURL(t)};var L={},D;if(typeof process<"u")try{typeof L<"u"&&(globalThis.__filename=fileURLToPath(L.url),globalThis.__dirname=fileURLToPath(new URL(".",L.url))),D=j("path").join(process.cwd(),__dirname,"dist","onnx.worker.js")}catch{}else{let s=globalThis.location.href.split("/");s.pop(),s=s.join("/"),D=s+"/dist/onnx.worker.js"}var A=D;var I,G=async()=>{I=await v(A)};G();var w=document.createElement("button"),y=document.createElement("canvas"),N=y.getContext("2d",{willReadFrequently:!0}),k=document.createElement("canvas"),$=k.getContext("2d",{willReadFrequently:!0});document.body.appendChild(w);document.body.insertAdjacentHTML("beforeend","<br/>");y.style.width="50%";document.body.appendChild(y);k.style.width="50%";document.body.appendChild(k);var _=async(o,s,l)=>{let e=await I.run({image:o,width:s,height:l},[o.buffer]);k.width=s,k.height=l;let t=q(e,s,l),d=new ImageData(t,s,l);$.putImageData(d,0,0)};w.innerText="Load Image";w.addEventListener("click",()=>{let o=document.createElement("input");o.type="file",o.accept="image/*",o.onchange=async s=>{let l=s.target.files[0];if(l){let e=new Image;e.onload=async()=>{y.width=e.width,y.height=e.height,N.drawImage(e,0,0);let t=N.getImageData(0,0,e.width,e.height);await _(t.data,e.width,e.height)},e.src=URL.createObjectURL(l)}},o.click()});function Z(o,s,l){let e=s*l,t=new Float32Array(e*3),d=new Uint32Array(o.buffer),R=0,p=e,u=2*e;for(let S=0;S<e;S++){let f=d[S],W=(f&255)/255,T=(f>>8&255)/255,M=(f>>16&255)/255;t[R++]=W,t[p++]=T,t[u++]=M}return t}function ee(o,s,l){let e=s*l,t=new Float32Array(e*3),d=.485,R=.229,p=.456,u=.224,S=.406,f=.225,W=new Uint32Array(o.buffer),T=0,M=e,m=2*e;for(let i=0;i<e;i++){let c=W[i],h=(c&255)/255,E=(c>>8&255)/255,n=(c>>16&255)/255;t[T++]=(h-d)/R,t[M++]=(E-p)/u,t[m++]=(n-S)/f}return t}function q(o,s,l){let e=s*l,t=new Uint8ClampedArray(e*4),d=0,R=e,p=2*e;for(let u=0;u<e;u++){let S=o[d++],f=o[R++],W=o[p++];t[u*4]=S,t[u*4+1]=f,t[u*4+2]=W,t[u*4+3]=255}return t}})();
